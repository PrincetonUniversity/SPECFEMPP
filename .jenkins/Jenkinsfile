pipeline{

    agent none

    stages{

        stage( ' Build main ' ){
            steps {

                echo ' Getting git submodules '
                sh 'git submodule init'
                sh 'git submodule update'

                echo ' Loading required module '

                echo ' Building '

                sh 'cmake3 -S . -B build -DCMAKE_BUILD_TYPE=Release'

                sh 'cmake3 --build build'

                echo ' Build completed '
            }
        }

        stage( ' Test Main ' ){

            steps {

                echo ' Running Unit Tests '

                sh 'cd build/tests/unit-tests'

                sh 'ctest'
            }
        }
    }
}
